# SmartCloudPlatform å•å…ƒæµ‹è¯•è¯´æ˜

## æ¦‚è¿°
æœ¬é¡¹ç›®å·²ç»åˆ›å»ºäº†å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–äº†å„ä¸ªåŠŸèƒ½æ¨¡å—ã€‚æµ‹è¯•ä»£ç éµå¾ªæœ€ä½³å®è·µï¼Œä½¿ç”¨JUnit 5å’ŒMockitoæ¡†æ¶ã€‚

## æµ‹è¯•æ–‡ä»¶ç»“æ„

### 1. æœåŠ¡å±‚æµ‹è¯• (Service Layer Tests)

#### `UserServiceTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/service/UserServiceTest.java`
- **æµ‹è¯•å†…å®¹**:
  - ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢ (`testSelectUserList`)
  - æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ· (`testSelectUserByUserName`)
  - æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ· (`testSelectUserById`)
  - ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥ (`testCheckUserNameUnique_NewUser`, `testCheckUserNameUnique_ExistingUser`)
  - æ‰‹æœºå·å”¯ä¸€æ€§æ£€æŸ¥ (`testCheckPhoneUnique_NewPhone`)
  - é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥ (`testCheckEmailUnique_NewEmail`)
  - ç”¨æˆ·åˆ›å»º (`testInsertUser`)
  - ç”¨æˆ·æ³¨å†Œ (`testRegisterUser`)
  - ç”¨æˆ·æ›´æ–° (`testUpdateUser`)
  - ç”¨æˆ·åˆ é™¤ (`testDeleteUserById`, `testDeleteUserByIds`)
  - ç®¡ç†å‘˜æƒé™æ£€æŸ¥ (`testIsAdmin`, `testCheckUserAllowed_AdminUser`, `testCheckUserAllowed_NormalUser`)
  - ç”¨æˆ·è§’è‰²ç»„æŸ¥è¯¢ (`testSelectUserRoleGroup`)

#### `RoleServiceTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/service/RoleServiceTest.java`
- **æµ‹è¯•å†…å®¹**:
  - è§’è‰²åˆ—è¡¨æŸ¥è¯¢ (`testSelectRoleList`)
  - æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è§’è‰² (`testSelectRolesByUserId`)
  - æŸ¥è¯¢æ‰€æœ‰è§’è‰² (`testSelectRoleAll`)
  - æ ¹æ®è§’è‰²IDæŸ¥è¯¢è§’è‰² (`testSelectRoleById`)
  - æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢è§’è‰² (`testSelectRolesByUserName`)
  - è§’è‰²åå”¯ä¸€æ€§æ£€æŸ¥ (`testCheckRoleNameUnique_NewRole`, `testCheckRoleNameUnique_ExistingRole`)
  - è§’è‰²åˆ›å»º (`testInsertRole`)
  - è§’è‰²æ›´æ–° (`testUpdateRole`)
  - è§’è‰²åˆ é™¤ (`testDeleteRoleById`, `testDeleteRoleByIds`)
  - è§’è‰²æƒé™æˆæƒ (`testInsertRoleAuth`, `testInsertRoleAuth_EmptyPermissions`, `testInsertRoleAuth_NullPermissions`)

#### `BreathSampleServiceTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/service/BreathSampleServiceTest.java`
- **æµ‹è¯•å†…å®¹**:
  - å‘¼å¸æ ·æœ¬åˆ—è¡¨æŸ¥è¯¢ (`testSelectBreathSampleList`)
  - æ ¹æ®æ ·æœ¬IDæŸ¥è¯¢ (`testSelectBreathSampleById`)
  - æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢æ ·æœ¬åˆ—è¡¨ (`testSelectBreathSamplesByUserId`)
  - æ ·æœ¬åˆ›å»º (`testInsertBreathSample`)
  - æ ·æœ¬æ›´æ–° (`testUpdateBreathSample`)
  - æ ·æœ¬åˆ é™¤ (`testDeleteBreathSampleById`, `testDeleteBreathSampleByIds`)
  - æ ¹æ®ç”¨æˆ·IDåˆ é™¤æ ·æœ¬ (`testDeleteBreathSampleByUserId`)
  - æ¡ä»¶æŸ¥è¯¢æµ‹è¯• (`testSelectBreathSampleList_WithConditions`)
  - å¼‚å¸¸æƒ…å†µæµ‹è¯• (`testSelectBreathSampleById_NotFound`, `testInsertBreathSample_Failed`)

### 2. æ§åˆ¶å™¨å±‚æµ‹è¯• (Controller Layer Tests)

#### `SysUserControllerTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/controller/SysUserControllerTest.java`
- **æµ‹è¯•å†…å®¹**:
  - ç”¨æˆ·åˆ—è¡¨API (`testGetUserList`)
  - ç”¨æˆ·è¯¦æƒ…API (`testGetUserInfo`, `testGetUserInfo_WithoutUserId`)
  - ç”¨æˆ·åˆ›å»ºAPI (`testAddUser_Success`, `testAddUser_DuplicateUserName`, `testAddUser_DuplicatePhone`)
  - ç”¨æˆ·æ›´æ–°API (`testEditUser_Success`)
  - ç”¨æˆ·åˆ é™¤API (`testRemoveUser_Success`, `testRemoveUser_AdminUser`)
  - å¯†ç é‡ç½®API (`testResetPassword`)
  - ç”¨æˆ·çŠ¶æ€ä¿®æ”¹API (`testChangeStatus`)
  - ç”¨æˆ·è§’è‰²æˆæƒAPI (`testAuthRole`, `testInsertAuthRole`)
  - éƒ¨é—¨æ ‘æŸ¥è¯¢API (`testDeptTree`)

#### `SysRoleControllerTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/controller/SysRoleControllerTest.java`
- **æµ‹è¯•å†…å®¹**:
  - è§’è‰²åˆ—è¡¨API (`testGetRoleList`)
  - è§’è‰²è¯¦æƒ…API (`testGetRoleInfo`)
  - è§’è‰²åˆ›å»ºAPI (`testAddRole`)
  - è§’è‰²æ›´æ–°API (`testEditRole`)
  - è§’è‰²åˆ é™¤API (`testRemoveRole`)
  - è§’è‰²é€‰é¡¹æŸ¥è¯¢API (`testOptionSelect`)

### 3. å®ä½“ç±»æµ‹è¯• (Entity Tests)

#### `EntityTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/entity/EntityTest.java`
- **æµ‹è¯•å†…å®¹**:
  - Userå®ä½“ç±»æµ‹è¯• (`testUserEntity`, `testUserValidation`)
  - Roleå®ä½“ç±»æµ‹è¯• (`testRoleEntity`)
  - BreathSampleå®ä½“ç±»æµ‹è¯• (`testBreathSampleEntity`, `testBreathSampleValidation`)
  - Permissionå®ä½“ç±»æµ‹è¯• (`testPermissionEntity`)
  - UserRoleså®ä½“ç±»æµ‹è¯• (`testUserRolesEntity`)
  - RolePermissionså®ä½“ç±»æµ‹è¯• (`testRolePermissionsEntity`)
  - å®ä½“ç±»equalså’ŒhashCodeæµ‹è¯• (`testEntityEqualsAndHashCode`)
  - å®ä½“ç±»toStringæµ‹è¯• (`testEntityToString`)

### 4. é›†æˆæµ‹è¯• (Integration Tests)

#### `UserIntegrationTest.java`
- **ä½ç½®**: `src/test/java/org/example/smartcloudplatform/integration/UserIntegrationTest.java`
- **æµ‹è¯•å†…å®¹**:
  - ç”¨æˆ·åˆ›å»ºæµç¨‹æµ‹è¯• (`testCreateUser`)
  - ç”¨æˆ·æŸ¥è¯¢æµç¨‹æµ‹è¯• (`testQueryUser`)
  - ç”¨æˆ·æ›´æ–°æµç¨‹æµ‹è¯• (`testUpdateUser`)
  - ç”¨æˆ·éªŒè¯æµç¨‹æµ‹è¯• (`testUserValidation`)
  - ç”¨æˆ·æƒé™æ£€æŸ¥æµ‹è¯• (`testUserPermissions`)
  - ç”¨æˆ·è§’è‰²ç»„æµ‹è¯• (`testUserRoleGroup`)
  - å¯†ç æ“ä½œæµ‹è¯• (`testPasswordOperations`)
  - ç”¨æˆ·åˆ é™¤æµ‹è¯• (`testDeleteUser`)
  - æ‰¹é‡æ“ä½œæµ‹è¯• (`testBatchOperations`)

## æµ‹è¯•é…ç½®

### æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶
- **ä½ç½®**: `src/test/resources/application-test.yml`
- **é…ç½®å†…å®¹**:
  - ä½¿ç”¨H2å†…å­˜æ•°æ®åº“è¿›è¡Œæµ‹è¯•
  - ç®€åŒ–çš„MyBatis Plusé…ç½®
  - æµ‹è¯•ä¸“ç”¨çš„JWTé…ç½®
  - ç¦ç”¨Swaggeræ–‡æ¡£ç”Ÿæˆ
  - ä¼˜åŒ–çš„æ—¥å¿—é…ç½®

## æµ‹è¯•ç‰¹ç‚¹

### 1. å…¨é¢è¦†ç›–
- **æœåŠ¡å±‚**: æµ‹è¯•æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æ–¹æ³•
- **æ§åˆ¶å™¨å±‚**: æµ‹è¯•æ‰€æœ‰REST APIç«¯ç‚¹
- **å®ä½“å±‚**: æµ‹è¯•å®ä½“ç±»çš„åŸºæœ¬åŠŸèƒ½å’ŒéªŒè¯
- **é›†æˆæµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹

### 2. ä½¿ç”¨Mockå¯¹è±¡
- ä½¿ç”¨`@MockBean`å’Œ`@Mock`æ³¨è§£æ¨¡æ‹Ÿä¾èµ–
- é¿å…çœŸå®æ•°æ®åº“æ“ä½œï¼Œæé«˜æµ‹è¯•é€Ÿåº¦
- ç¡®ä¿æµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§

### 3. æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨`@BeforeEach`æ–¹æ³•å‡†å¤‡æµ‹è¯•æ•°æ®
- ä½¿ç”¨`@Transactional`æ³¨è§£ç¡®ä¿æµ‹è¯•æ•°æ®éš”ç¦»
- ä½¿ç”¨å†…å­˜æ•°æ®åº“H2è¿›è¡Œé›†æˆæµ‹è¯•

### 4. å¼‚å¸¸æƒ…å†µæµ‹è¯•
- æµ‹è¯•å„ç§è¾¹ç•Œæ¡ä»¶
- æµ‹è¯•å¼‚å¸¸è¾“å…¥å’Œé”™è¯¯æƒ…å†µ
- éªŒè¯å¼‚å¸¸å¤„ç†é€»è¾‘

### 5. éªŒè¯é€»è¾‘å®Œæ•´
- ä½¿ç”¨æ–­è¨€éªŒè¯æµ‹è¯•ç»“æœ
- ä½¿ç”¨`verify()`æ–¹æ³•éªŒè¯Mockå¯¹è±¡çš„è°ƒç”¨
- æµ‹è¯•è¿”å›å€¼ã€å¼‚å¸¸æŠ›å‡ºç­‰å„ç§æƒ…å†µ

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
./mvnw test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
```bash
./mvnw test -Dtest=UserServiceTest
./mvnw test -Dtest=SysUserControllerTest
./mvnw test -Dtest=EntityTest
./mvnw test -Dtest=UserIntegrationTest
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
```bash
./mvnw test -Dtest=UserServiceTest#testSelectUserList
```

## æµ‹è¯•æŠ¥å‘Š
æµ‹è¯•è¿è¡Œåä¼šç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- æµ‹è¯•é€šè¿‡ç‡
- ä»£ç è¦†ç›–ç‡
- å¤±è´¥æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯
- æ€§èƒ½ç»Ÿè®¡

## æœ€ä½³å®è·µ

1. **æµ‹è¯•å‘½å**: ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•æ–¹æ³•åï¼Œæ¸…æ¥šè¡¨è¾¾æµ‹è¯•æ„å›¾
2. **æµ‹è¯•ç»“æ„**: éµå¾ªAAAæ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰
3. **æµ‹è¯•ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
4. **æµ‹è¯•æ•°æ®**: ä½¿ç”¨å›ºå®šçš„æµ‹è¯•æ•°æ®ï¼Œç¡®ä¿ç»“æœå¯é¢„æµ‹
5. **å¼‚å¸¸æµ‹è¯•**: å……åˆ†æµ‹è¯•å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
6. **Mockä½¿ç”¨**: åˆç†ä½¿ç”¨Mockå¯¹è±¡ï¼Œé¿å…å¤–éƒ¨ä¾èµ–

## æ³¨æ„äº‹é¡¹

1. æµ‹è¯•ç¯å¢ƒä½¿ç”¨H2å†…å­˜æ•°æ®åº“ï¼Œä¸ä¼šå½±å“å¼€å‘æˆ–ç”Ÿäº§æ•°æ®
2. é›†æˆæµ‹è¯•ä½¿ç”¨`@Transactional`æ³¨è§£ï¼Œæµ‹è¯•åè‡ªåŠ¨å›æ»š
3. æ§åˆ¶å™¨æµ‹è¯•ä½¿ç”¨`@WebMvcTest`ï¼ŒåªåŠ è½½Webå±‚ç»„ä»¶
4. æœåŠ¡å±‚æµ‹è¯•ä½¿ç”¨`@ExtendWith(MockitoExtension.class)`ï¼Œçº¯å•å…ƒæµ‹è¯•
5. å®ä½“ç±»æµ‹è¯•åŒ…å«Bean ValidationéªŒè¯æµ‹è¯•

è¿™äº›æµ‹è¯•ç¡®ä¿äº†SmartCloudPlatformé¡¹ç›®çš„å„ä¸ªåŠŸèƒ½æ¨¡å—éƒ½èƒ½æ­£ç¡®å·¥ä½œï¼Œä¸ºä»£ç è´¨é‡æä¾›äº†å¯é ä¿éšœã€‚

# APIæ–‡æ¡£å¯¼å‡ºæµ‹è¯•è¯´æ˜

## æµ‹è¯•ç¯å¢ƒ
- æ“ä½œç³»ç»Ÿ: macOS 14.5.0
- Javaç‰ˆæœ¬: 17
- Pythonç‰ˆæœ¬: 3.12
- é¡¹ç›®: æ™ºèƒ½äº‘å¹³å°ç®¡ç†ç³»ç»Ÿ

## æµ‹è¯•ç»“æœ

### âœ… æˆåŠŸç”Ÿæˆé™æ€APIæ–‡æ¡£

**æµ‹è¯•æ—¶é—´**: 2025-06-21 23:56

**ä½¿ç”¨å·¥å…·**: `simple_generate_docs.py`

**ç”Ÿæˆæ–‡ä»¶**:
- `api-docs.json` (25,049 bytes) - OpenAPI 3.0è§„èŒƒæ–‡ä»¶
- `api-docs.html` (5,944 bytes) - ç¾åŒ–çš„HTMLæ–‡æ¡£

### ğŸ“‹ å¯¼å‡ºçš„APIæ¥å£

æˆåŠŸå¯¼å‡ºäº†ä»¥ä¸‹APIæ¥å£ï¼š

#### ç”¨æˆ·ç®¡ç†æ¥å£
- `POST /system/user` - æ–°å¢ç”¨æˆ·
- `GET /system/user/list` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /system/user/{userId}` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PUT /system/user` - ä¿®æ”¹ç”¨æˆ·
- `DELETE /system/user/{userId}` - åˆ é™¤ç”¨æˆ·
- `PUT /system/user/resetPwd` - é‡ç½®å¯†ç 
- `PUT /system/user/changeStatus` - ä¿®æ”¹ç”¨æˆ·çŠ¶æ€
- `GET /system/user/deptTree` - è·å–éƒ¨é—¨æ ‘
- `GET /system/user/authRole/{userId}` - è·å–ç”¨æˆ·è§’è‰²
- `PUT /system/user/authRole` - åˆ†é…ç”¨æˆ·è§’è‰²

#### è§’è‰²ç®¡ç†æ¥å£
- `POST /system/role` - æ–°å¢è§’è‰²
- `GET /system/role/list` - è·å–è§’è‰²åˆ—è¡¨
- `GET /system/role/{roleId}` - è·å–è§’è‰²è¯¦æƒ…
- `PUT /system/role` - ä¿®æ”¹è§’è‰²
- `DELETE /system/role/{roleId}` - åˆ é™¤è§’è‰²
- `PUT /system/role/changeStatus` - ä¿®æ”¹è§’è‰²çŠ¶æ€
- `GET /system/role/optionSelect` - è§’è‰²é€‰æ‹©æ¡†åˆ—è¡¨
- `GET /system/role/authUser/{roleId}` - è·å–è§’è‰²ç”¨æˆ·
- `PUT /system/role/authUser/cancel` - å–æ¶ˆç”¨æˆ·è§’è‰²
- `PUT /system/role/authUser/cancelAll` - æ‰¹é‡å–æ¶ˆç”¨æˆ·è§’è‰²
- `PUT /system/role/authUser/selectAll` - æ‰¹é‡é€‰æ‹©ç”¨æˆ·è§’è‰²

### ğŸ”§ é…ç½®ä¿¡æ¯

**åº”ç”¨é…ç½®**:
- æœåŠ¡å™¨ç«¯å£: 8080
- Context Path: `/api`
- Swagger UIåœ°å€: `http://localhost:8080/api/swagger-ui/index.html`
- APIæ–‡æ¡£ç«¯ç‚¹: `http://localhost:8080/api/v3/api-docs`

**æ–‡æ¡£ä¿¡æ¯**:
- OpenAPIç‰ˆæœ¬: 3.0.1
- æ–‡æ¡£æ ‡é¢˜: æ™ºèƒ½äº‘å¹³å°ç®¡ç†ç³»ç»ŸAPIæ–‡æ¡£
- æ–‡æ¡£æè¿°: åŸºäºSpringBoot3 + MyBatis Plusçš„å‰åç«¯åˆ†ç¦»ç®¡ç†ç³»ç»Ÿ
- ç‰ˆæœ¬: 1.0.0

### ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- æ€»æ¥å£æ•°: 20+
- GETæ¥å£: 8ä¸ª
- POSTæ¥å£: 2ä¸ª
- PUTæ¥å£: 8ä¸ª
- DELETEæ¥å£: 2ä¸ª
- åˆ†ç»„æ ‡ç­¾: ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†

### ğŸŒ æŸ¥çœ‹æ–¹å¼

1. **ç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶**:
   ```bash
   open api-docs.html
   ```

2. **HTTPæœåŠ¡å™¨æ–¹å¼**:
   ```bash
   python3 -m http.server 3000
   # è®¿é—®: http://localhost:3000/api-docs.html
   ```

3. **åœ¨çº¿Swagger UI**:
   ```bash
   # å¯åŠ¨åº”ç”¨åè®¿é—®
   http://localhost:8080/api/swagger-ui/index.html
   ```

### ğŸ¯ æµ‹è¯•ç»“è®º

âœ… **æˆåŠŸ**: é™æ€APIæ–‡æ¡£å¯¼å‡ºåŠŸèƒ½å®Œå…¨æ­£å¸¸
âœ… **å®Œæ•´**: æ‰€æœ‰Controllerä¸­çš„APIæ¥å£éƒ½è¢«æ­£ç¡®å¯¼å‡º
âœ… **æ ¼å¼**: ç”Ÿæˆçš„æ–‡æ¡£ç¬¦åˆOpenAPI 3.0è§„èŒƒ
âœ… **ç¾è§‚**: HTMLæ–‡æ¡£ç•Œé¢ç¾è§‚ï¼Œæ˜“äºé˜…è¯»
âœ… **å®ç”¨**: å¯ä»¥ç¦»çº¿æŸ¥çœ‹ï¼Œæ–¹ä¾¿åˆ†äº«å’Œå­˜æ¡£

### ğŸ“ ä½¿ç”¨å»ºè®®

1. å®šæœŸè¿è¡Œè„šæœ¬æ›´æ–°APIæ–‡æ¡£
2. å°†ç”Ÿæˆçš„æ–‡æ¡£åŠ å…¥ç‰ˆæœ¬æ§åˆ¶
3. å¯ä»¥é›†æˆåˆ°CI/CDæµç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆ
4. å»ºè®®åŒæ—¶ä¿ç•™JSONå’ŒHTMLä¸¤ç§æ ¼å¼

### ğŸ”„ åç»­ä¼˜åŒ–

- [ ] æ”¯æŒç”ŸæˆPDFæ ¼å¼æ–‡æ¡£
- [ ] æ·»åŠ APIå˜æ›´å¯¹æ¯”åŠŸèƒ½
- [ ] æ”¯æŒå¤šç¯å¢ƒé…ç½®
- [ ] é›†æˆåˆ°Mavenæ„å»ºæµç¨‹ 