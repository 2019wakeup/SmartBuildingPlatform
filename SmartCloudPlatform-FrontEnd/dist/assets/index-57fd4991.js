import{am as C,d as R,c as I,b as t,w as n,ak as w,v as V,o as $,h as c,n as A,p as B,E as D,q,_ as E,a5 as U,H as z,a as S,r as b,al as F,f as L,K as j,m as P}from"./index-40611390.js";import{v as M}from"./el-loading-a5a97b93.js";import{E as H,a as K,b as G}from"./el-table-column-7d5a23c4.js";import"./el-select-9508f823.js";import"./strings-eb1a87b1.js";function T(u){return C.get("/system/role/list",{params:u})}function J(u){const o={role_name:u.roleName,remark:u.remark};return C.post("/system/role",o)}function O(u){const o={role_id:u.roleId,role_name:u.roleName,remark:u.remark};return C.put("/system/role",o)}function Q(u){return C.delete(`/system/role/${u.join(",")}`)}const W={class:"search-form"},X=R({__name:"RoleSearchForm",props:{queryParams:{}},emits:["search"],setup(u,{emit:o}){const e=u,m=o,r=()=>{e.queryParams.roleName="",e.queryParams.pageNum=1,m("search")};return(d,a)=>{const l=A,s=B,f=w("Search"),g=D,y=q,k=w("Refresh"),v=V;return $(),I("div",W,[t(v,{model:d.queryParams,inline:!0},{default:n(()=>[t(s,{label:"角色名称"},{default:n(()=>[t(l,{modelValue:d.queryParams.roleName,"onUpdate:modelValue":a[0]||(a[0]=N=>d.queryParams.roleName=N),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(s,null,{default:n(()=>[t(y,{type:"primary",onClick:a[1]||(a[1]=N=>d.$emit("search"))},{default:n(()=>[t(g,null,{default:n(()=>[t(f)]),_:1}),a[2]||(a[2]=c("搜索 "))]),_:1,__:[2]}),t(y,{onClick:r},{default:n(()=>[t(g,null,{default:n(()=>[t(k)]),_:1}),a[3]||(a[3]=c("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])])}}});const Y=E(X,[["__scopeId","data-v-98927bc2"]]),Z={class:"action-buttons"},x=R({__name:"RoleActionButtons",props:{selectedRows:{}},emits:["add","edit","delete","test"],setup(u){return(o,e)=>{const m=w("Plus"),r=D,d=q,a=w("Edit"),l=w("Delete"),s=w("Tools");return $(),I("div",Z,[t(d,{type:"primary",onClick:e[0]||(e[0]=f=>o.$emit("add"))},{default:n(()=>[t(r,null,{default:n(()=>[t(m)]),_:1}),e[4]||(e[4]=c("新增角色 "))]),_:1,__:[4]}),t(d,{type:"success",onClick:e[1]||(e[1]=f=>o.$emit("edit")),disabled:o.selectedRows.length!==1},{default:n(()=>[t(r,null,{default:n(()=>[t(a)]),_:1}),e[5]||(e[5]=c("修改 "))]),_:1,__:[5]},8,["disabled"]),t(d,{type:"danger",onClick:e[2]||(e[2]=f=>o.$emit("delete")),disabled:o.selectedRows.length===0},{default:n(()=>[t(r,null,{default:n(()=>[t(l)]),_:1}),e[6]||(e[6]=c("删除 "))]),_:1,__:[6]},8,["disabled"]),t(d,{type:"warning",onClick:e[3]||(e[3]=f=>o.$emit("test"))},{default:n(()=>[t(r,null,{default:n(()=>[t(s)]),_:1}),e[7]||(e[7]=c("测试API "))]),_:1,__:[7]})])}}});const h=E(x,[["__scopeId","data-v-01d11c19"]]),ee={class:"table-container"},te={class:"pagination-container"},oe=R({__name:"RoleTable",props:{data:{},total:{},loading:{type:Boolean},selectedRows:{},queryParams:{}},emits:["update:selectedRows","update:queryParams","edit","delete","refresh"],setup(u){return(o,e)=>{const m=G,r=q,d=H,a=K,l=M;return $(),I("div",ee,[U(($(),z(d,{data:o.data,style:{width:"100%"},onSelectionChange:e[0]||(e[0]=s=>o.$emit("update:selectedRows",s))},{default:n(()=>[t(m,{type:"selection",width:"55"}),t(m,{prop:"roleId",label:"角色ID",width:"100"}),t(m,{prop:"roleName",label:"角色名称"}),t(m,{prop:"createTime",label:"创建时间",width:"180"}),t(m,{prop:"updateTime",label:"更新时间",width:"180"}),t(m,{label:"操作",width:"200",fixed:"right"},{default:n(({row:s})=>[t(r,{type:"primary",text:"",onClick:f=>o.$emit("edit",s)},{default:n(()=>e[5]||(e[5]=[c("修改")])),_:2,__:[5]},1032,["onClick"]),t(r,{type:"danger",text:"",onClick:f=>o.$emit("delete",s)},{default:n(()=>e[6]||(e[6]=[c("删除")])),_:2,__:[6]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[l,o.loading]]),S("div",te,[t(a,{"current-page":o.queryParams.pageNum,"onUpdate:currentPage":e[1]||(e[1]=s=>o.queryParams.pageNum=s),"page-size":o.queryParams.pageSize,"onUpdate:pageSize":e[2]||(e[2]=s=>o.queryParams.pageSize=s),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e[3]||(e[3]=s=>o.$emit("refresh")),onCurrentChange:e[4]||(e[4]=s=>o.$emit("refresh"))},null,8,["current-page","page-size","total"])])])}}});const le=E(oe,[["__scopeId","data-v-b6afb063"]]),ae={class:"dialog-footer"},ne=R({__name:"RoleDialog",props:{visible:{type:Boolean},role:{},isEdit:{type:Boolean}},emits:["submit","cancel","update:visible"],setup(u,{emit:o}){const e=o,m={roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},r=b(),d=async()=>{r.value&&(await r.value.validate(),e("submit"))};return(a,l)=>{const s=A,f=B,g=V,y=q,k=F;return $(),z(k,{"model-value":a.visible,"onUpdate:modelValue":l[3]||(l[3]=v=>e("update:visible",v)),title:a.isEdit?"修改角色":"新增角色",width:"600px",onClose:l[4]||(l[4]=v=>e("cancel"))},{footer:n(()=>[S("span",ae,[t(y,{onClick:l[2]||(l[2]=v=>e("cancel"))},{default:n(()=>l[5]||(l[5]=[c("取消")])),_:1,__:[5]}),t(y,{type:"primary",onClick:d},{default:n(()=>l[6]||(l[6]=[c("确定")])),_:1,__:[6]})])]),default:n(()=>[t(g,{model:a.role,ref_key:"formRef",ref:r,rules:m,"label-width":"100px"},{default:n(()=>[t(f,{label:"角色名称",prop:"roleName"},{default:n(()=>[t(s,{modelValue:a.role.roleName,"onUpdate:modelValue":l[0]||(l[0]=v=>a.role.roleName=v)},null,8,["modelValue"])]),_:1}),t(f,{label:"备注"},{default:n(()=>[t(s,{modelValue:a.role.remark,"onUpdate:modelValue":l[1]||(l[1]=v=>a.role.remark=v),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}}),se={class:"role-management"},re=R({__name:"index",setup(u){const o=b([]),e=b(0),m=b(!1),r=b(!1),d=b([]),a=L({pageNum:1,pageSize:10,roleName:""}),l=b({roleId:void 0,roleName:"",remark:""}),s=async()=>{m.value=!0;try{const _=await T(a);if(_.success&&_.data){const p=Array.isArray(_.data.rows)?_.data.rows:_.data;o.value=p.map(i=>({roleId:i.role_id??i.roleId,roleName:i.role_name??i.roleName,createTime:i.create_time??i.createTime,updateTime:i.update_time??i.updateTime,remark:i.remark})),e.value=_.data.total??p.length}else o.value=[],e.value=0}finally{m.value=!1}},f=()=>{l.value={roleId:void 0,roleName:"",remark:""},r.value=!0},g=_=>{_&&(l.value={..._},r.value=!0)},y=async _=>{const p=_?[_]:d.value;p.length&&(await Q(p.map(i=>i.roleId)),P.success("删除成功"),s())},k=async()=>{l.value.roleId?(await O(l.value),P.success("修改成功")):(await J(l.value),P.success("添加成功")),r.value=!1,s()},v=()=>{l.value={roleId:void 0,roleName:"",remark:""}},N=async()=>{const _=await T({pageNum:1,pageSize:10});console.log("测试API响应:",_),P.success("API测试完成")};return j(s),(_,p)=>($(),I("div",se,[p[4]||(p[4]=S("div",{class:"page-title"},"角色管理",-1)),t(Y,{queryParams:a,"onUpdate:queryParams":p[0]||(p[0]=i=>a=i),onSearch:s},null,8,["queryParams"]),t(h,{"selected-rows":d.value,onAdd:f,onEdit:g,onDelete:y,onTest:N},null,8,["selected-rows"]),t(le,{data:o.value,total:e.value,loading:m.value,"selected-rows":d.value,"onUpdate:selectedRows":p[1]||(p[1]=i=>d.value=i),"query-params":a,"onUpdate:queryParams":p[2]||(p[2]=i=>a=i),onRefresh:s,onEdit:g,onDelete:y},null,8,["data","total","loading","selected-rows","query-params"]),t(ne,{visible:r.value,"onUpdate:visible":p[3]||(p[3]=i=>r.value=i),role:l.value,"is-edit":!!l.value.roleId,onSubmit:k,onCancel:v},null,8,["visible","role","is-edit"])]))}});const _e=E(re,[["__scopeId","data-v-f3b48f42"]]);export{_e as default};
